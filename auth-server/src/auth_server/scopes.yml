# Pure new RBAC scopes for registry server/agent APIs.
# Scopes configuration for role-based permissions focused on server/agent APIs.
#
# Roles:
# - registry-admin: full access
# - registry-power-user: create/delete/share servers, read agents
# - register-user: create servers and agents, cannot share
# - register-read-only: read-only access to servers and agents

## server:
#  /servers (GET)
#  /servers/{server_id} (GET)
#  /servers/stats (GET)
#  /servers/connection (POST)
#  /servers/{server_id}/tools (GET)
#  /servers/{server_id}/refresh (POST)
#  /servers (POST)
#  /servers/{server_id} (PATCH)
#  /servers/{server_id} (DELETE)
#  /servers/{server_id}/toggle (POST)
#
## agent:
#  /agents (GET)
#  /agents/{path} (GET)
#  /agents/{path}/rating (GET)
#  /agents/discover (POST)
#  /agents/discover/semantic (POST)
#  /agents/{path}/health (POST)
#  /agents/register (POST)
#  /agents/{path} (PUT)
#  /agents/{path} (DELETE)
#  /agents/{path}/toggle (POST)
#  /agents/{path}/rate (POST)
group_mappings:
  jarvis-registry-admin:
    - servers-read
    - agents-read
    - agents-write
    - server-write
    - servers-share
    - agents-share
  jarvis-registry-power-user:
    - servers-read
    - agents-read
    - agents-write
    - server-write
    - servers-share
    - agents-share
  jarvis-register-user:
    - servers-read
    - agents-read
    - agents-write
    - server-write
  jarvis-register-read-only:
    - servers-read
    - agents-read

servers-read:
  - action: list_servers # name
    method: GET  # GET,POST or *
    endpoint: /servers # *  求交集
  - action: get_server
    method: GET
    endpoint: /servers/{server_id}
  - action: servers_stats
    method: GET
    endpoint: /servers/stats
  - action: servers_connection
    method: POST
    endpoint: /servers/connection
  - action: get_server_tools
    method: GET
    endpoint: /servers/{server_id}/tools
  - action: refresh_server_health
    method: POST
    endpoint: /servers/{server_id}/refresh

agents-read:
  - action: list_agents
    method: GET
    endpoint: /agents
  - action: get_agent
    method: GET
    endpoint: /agents/{path}
  - action: get_agent_rating
    method: GET
    endpoint: /agents/{path}/rating
  - action: discover_agents
    method: POST
    endpoint: /agents/discover
  - action: discover_agents_semantic
    method: POST
    endpoint: /agents/discover/semantic
  - action: check_agent_health
    method: POST
    endpoint: /agents/{path}/health

agents-write:
  - action: publish_agent
    method: POST
    endpoint: /agents/register
  - action: modify_agent
    method: PUT
    endpoint: /agents/{path}
  - action: delete_agent
    method: DELETE
    endpoint: /agents/{path}
  - action: toggle_agent
    method: POST
    endpoint: /agents/{path}/toggle
  - action: rate_agent
    method: POST
    endpoint: /agents/{path}/rate

server-write:
  - action: register_service
    method: POST
    endpoint: /servers
  - action: modify_service
    method: PATCH
    endpoint: /servers/{server_id}
  - action: delete_service
    method: DELETE
    endpoint: /servers/{server_id}
  - action: toggle_service
    method: POST
    endpoint: /servers/{server_id}/toggle

servers-share:
  - action: share_service
    method: PUT
    endpoint: /permissions/mcpServer/{resource_id}

agents-share:
  - action: share_agent
    method: PUT
    endpoint: /permissions/agent/{resource_id}
